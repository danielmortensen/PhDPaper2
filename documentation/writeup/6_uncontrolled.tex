\section{Integrating Uncontrolled Loads}
Next, we desire to integrate the charge decisions with uncontrolled loads.  These loads are sampled discretly and so the results for the power use must be converted into a compatible format.  To start, define
\begin{align}
	k_0\cdot\Delta T + r_0&= c_{ijk} \\
	k_1\cdot\Delta T + r_1&= s_{ijk} \\
	k_1, k_0 \in \mathbb{Z} \\
	0 < r_0, r_1 < &\Delta T.
\end{align}
We desire to find binary vectors $\mathbf{s}_0$, $\mathbf{s}$, and $\mathbf{s_1}$ which act as selectors for times where a bus is on-ramping, charging, and off-ramping respectively. The on-ramping charging, and off-ramping periods will be used to represent power use from $k_0$ to $k_0 + 1$, $k_0 + 1$ to $k_1$ and $k_1$ to $k_1 + 1$ respectively. 
\par Let $\mathbf{i}$ be a vector of one-based integer indices such that $\mathbf{i}_w = w \ \forall w \in (1,\text{nTime})$. The values in $\mathbf{s}_0$ can be defined by the constraint
\begin{align}
	k_0 &= \mathbf{s}_0^T\mathbf{i} \\
	1 &= \mathbf{1}^T\mathbf{s}_0 \\
	\mathbf{s}_0 &\in \{0,1\}.
\end{align}
Similarly, the values for $\mathbf{s_1}$ can be defined as
\begin{align}
	k_1 &= \mathbf{s}_1^T\mathbf{i}\\
	1 &= \mathbf{1}^T\mathbf{s}_1 \\
	\mathbf{s}_1 &\in \{0,1\}.
\end{align}
The final piece is to define $\mathbf{s}$. The set of constraints can be described as follows: 
\begin{align}
	\mathbf{1}^T\mathbf{s} &= k_1 - k_0 - 1 \\
	\mathbf{s}_i\mathbf{i}_i &\le k_1 + M(1 - \mathbf{s}_i)\\
	\mathbf{s}_i\mathbf{i}_i &\ge k_0 - M(1 - \mathbf{s}_i)\\ 
\end{align}
where $M$ is $2\cdot\text{nTime}$.
\par We next define the average per use for each charger during an interval. The on-ramp intervals can be constrained as
\begin{align}
	p_{\text{on-ramp}} &= \frac{\text{powerRate}\cdot (\Delta T - r_0)}{\Delta T}\\
	p_{\text{off-ramp}} &= \frac{\text{powerRate}\cdot r_1}{\Delta T}\\
	p &= \text{powerRate},
\end{align}
where $p_0$, $p_1$, and $p$ represent the average power rate for the on-ramping, off-ramping, and charging intervals respectively.
The total average power use is calculated as 
\begin{align}\label{eqn:totalPower}
	\mathbf{p}_{\text{total}} = \mathbf{p} + \mathbf{s}_0\cdot p_0 + \mathbf{s}\cdot p + \mathbf{s}_1\cdot p_1
\end{align}
where $\mathbf{p}$ is the average power of the uncontrolled loads.
\par Note, however that the results from equation \ref{eqn:totalPower} contain a bilinear form. The first bilnear expression in  equation \ref{eqn:totalPower} can be rewritten as 
\begin{equation}
	\begin{aligned}
		p_0^w &\ge p_{\text{on-ramp}} - M(1 - s_0^w) \\
		p_0^w &\le p_{\text{on-ramp}} + M(1 - s_0^w) \\
		p_0^w &\ge -Ms_0^w \\
		p_0^w &\le Ms_0^w
	\end{aligned}
\end{equation}
and similarly the second as, 
\begin{equation}
	\begin{aligned}
		p_1^w &\ge p_{\text{off-ramp}} - M(1 - s_1^w) \\
		p_1^w &\le p_{\text{off-ramp}} + M(1 - s_1^w) \\
		p_1^w &\ge -Ms_1^w \\
		p_1^w &\le Ms_1^w.
	\end{aligned}
\end{equation}
An expression for the total power used can then be derived as
\begin{equation}
	\begin{aligned}
		\mathbf{p}_{\text{total}} = \mathbf{p} + \mathbf{p}_0 + \mathbf{p}_1 + \mathbf{s}\cdot p
	\end{aligned}
\end{equation}
TODO: 
\begin{enumerate}
	\item Figure out notation for each bus and how to integrate it into this framework
	\item flush out constraints and get into matrix/standard form
\end{enumerate}
